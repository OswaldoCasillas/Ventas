<!doctype html><html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Registrar venta</title>
<style>body{font-family:system-ui;margin:16px;max-width:640px}label{display:block;margin:12px 0 6px}
input,select,button{width:100%;font-size:18px;padding:10px;border:1px solid #ccc;border-radius:8px}
.row{display:flex;gap:8px}.row>*{flex:1}.help{font-size:12px;color:#666}</style>
</head><body>
<h1>Registrar venta</h1>
<p class="help">Selecciona producto y cantidad. Al enviar, se abrirá GitHub con la venta prellenada.</p>
<label>Fecha</label><input id="fecha" type="date">
<label>Producto</label><select id="item"></select>
<div class="row">
  <div><label>Cantidad</label><input id="cantidad" type="number" min="1" value="1"></div>
  <div><label>Precio unitario (opcional)</label><input id="precio" type="number" step="0.01"></div>
</div>
<label>Notas (opcional)</label><input id="notas" type="text">
<button id="enviar">Enviar</button>
<p class="help">QR rápido por producto: <a id="qr-link" href="#">crear</a></p>

<script>
  // ⬇️ Cambia por tu usuario/org y repo
  const ORG = "OswaldoCasillas"; const REPO = "Ventas";
  document.getElementById('fecha').valueAsDate = new Date();
  async function loadMenu(){
    const res = await fetch('menu.json?_='+Date.now()); const items = res.ok?await res.json():[];
    const sel = document.getElementById('item');
    sel.innerHTML = items.map(x=>`<option value="${x.item}" data-precio="${x.precio||''}">${x.item} — ${x.descripcion}${x.precio?(' ($'+x.precio+')'):''}</option>`).join('');
    sel.addEventListener('change',()=>{const p=sel.selectedOptions[0]?.dataset?.precio; if(p && !precio.value) precio.value=p;});
  }
  function buildIssueUrl({fecha,item,cantidad,precio,notas}){
    const base = `https://github.com/${ORG}/${REPO}/issues/new`;
    const title = `Venta: ${item} x${cantidad} @ ${fecha}`;
    const body  = `**Fecha**: ${fecha}\n**Item**: ${item}\n**Cantidad**: ${cantidad}\n**Precio unitario (opcional)**: ${precio||''}\n**Notas**: ${notas||''}`;
    const p = new URLSearchParams({template:'sale.md', title, body}); return `${base}?${p.toString()}`;
  }
  enviar.onclick = ()=> {
    const fecha=fechaInput.value||fecha.value, item=itemSelect.value||item.value, cantidad=cantidadInput?.value||cantidad.value;
    const url=buildIssueUrl({fecha,item,cantidad,precio:precio.value,notas:notas.value});
    if(!fecha||!item||!cantidad) return alert("Completa fecha, producto y cantidad.");
    location.href=url;
  }
  document.getElementById('qr-link').onclick = e => {e.preventDefault(); const u = new URL(location.href); u.searchParams.set('item', document.getElementById('item').value); prompt("Copia este enlace y conviértelo en QR:", u.toString());};
  // helpers
  const fechaInput=document.getElementById('fecha'), itemSelect=document.getElementById('item'), cantidadInput=document.getElementById('cantidad');
  loadMenu();
</script>
</body></html>
